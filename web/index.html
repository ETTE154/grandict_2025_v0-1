<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Go2 제어 챗</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh; }
      header { padding: 12px 16px; background: #0f172a; color: #fff; font-weight: 600; }
      #chat { flex: 1; overflow-y: auto; padding: 16px; background: #f8fafc; }
      .msg { margin-bottom: 12px; max-width: 80ch; }
      .user { color: #0f172a; }
      .bot { color: #1f2937; }
      .bubble { display: inline-block; padding: 8px 12px; border-radius: 10px; }
      .user .bubble { background: #dbeafe; }
      .bot .bubble { background: #e5e7eb; }
      form { display: flex; gap: 8px; padding: 12px; border-top: 1px solid #e5e7eb; }
      input[type="text"] { flex: 1; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; }
      button { padding: 10px 14px; border: none; border-radius: 8px; background: #2563eb; color: #fff; font-weight: 600; cursor: pointer; }
      button:disabled { opacity: .6; cursor: not-allowed; }
    </style>
  </head>
  <body>
    <header>Go2 제어 챗 (LangGraph + Ollama)</header>
    <div id="chat"></div>
    <form id="f">
      <input id="t" type="text" placeholder="메시지를 입력하세요 (예: 따라가라 / 길을 막아라)" autocomplete="off" />
      <button type="submit">전송</button>
    </form>
    <script>
      const chat = document.getElementById('chat');
      const form = document.getElementById('f');
      const input = document.getElementById('t');
      const sessionId = 'default';

      function addMsg(role, text) {
        const wrap = document.createElement('div');
        wrap.className = `msg ${role}`;
        const bubble = document.createElement('div');
        bubble.className = 'bubble';
        bubble.textContent = text;
        wrap.appendChild(bubble);
        chat.appendChild(wrap);
        chat.scrollTop = chat.scrollHeight;
      }

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const text = input.value.trim();
        if (!text) return;
        addMsg('user', text);
        input.value = '';
        input.disabled = true;
        form.querySelector('button').disabled = true;
        try {
          const res = await fetch('/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ session_id: sessionId, message: text })
          });
          const data = await res.json();
          if (data.reply) addMsg('bot', data.reply);
          else addMsg('bot', data.error || '오류가 발생했습니다.');
        } catch (err) {
          addMsg('bot', '네트워크 오류: ' + err);
        } finally {
          input.disabled = false;
          form.querySelector('button').disabled = false;
          input.focus();
        }
      });
    </script>
  </body>
  </html>

